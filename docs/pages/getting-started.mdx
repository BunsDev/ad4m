import { Steps } from "nextra-theme-docs";

# Getting Started

<Steps>

### Install AD4M Launcher

Download the latest version of the AD4M launcher from
its [GitHub release page](https://github.com/perspect3vism/ad4min/releases) and run/install it.

After creating an agent, you should see an AD4M system-tray icon which will
bring up an AD4M pop-up window when you click it:

![ad4min-screenshots](/images/launcher.jpg)

### Setup app to connect to AD4M

Install npm dependencies in your project:

```
npm install -s @perspect3vism/ad4m @perspect3vism/ad4m-connect
```

### Connect UI client using `ad4m-connect`

ADAM will expose a GraphQL endpoint on localhost that any website or native app can try to connect to.

Apps need to be granted capabilities to be able to access your agents data.
This is done by requesting a capability token and using the token to connect to the GraphQL API.

To avoid the complexity of setting up this authentication flow [ad4m-connect](https://github.com/perspect3vism/ad4m-connect)
will do all of this for you and just deliver an initialized and usable
[Ad4mClient](/jsdoc/classes/Ad4mClient) object.

#### Web/Browser UI

```js
import Ad4mConnect from "@perspect3vism/ad4m-connect";

const ui = Ad4mConnect({
  appName: "Example",
  appDesc: "This is a sample app.",
  appDomain: "ad4m.dev",
  appIconPath: "https://i.ibb.co/GnqjPJP/icon.png",
  capabilities: [
    {
      with: { domain: "_", pointers: ["_"] },
      can: ["*"],
    },
  ],
});

ui.connect().then((client) => {
  // Save the client
});

ui.addEventListener("authstatechange", (e) => {
  if (auth.authState === "connected") {
    // You are connected to ADAM
  }
});
```

This will initialize a web component and create a modal dialog over your UI.
After the first successful hand-shake, `ad4m-connect` will put the token there
and on next start-up of your app will check if the token still works and
not prompt the user again.

This is what your user will see when the app is not connected yet:

![ad4m-connect-1](/images/connect.jpg)

Since all the users's data is stored locally in AD4M Perspectives,
using a new app/UI and granting it access to all or parts of these perspectives
and AD4M functionality is potentially risky.
`ad4m-connect` not only makes it easy for app developers to connect to the users AD4M-executor,
it also provides a recognizable interface/wizard for the user.

Like in this example, an app/UI should provide its name and an icon for the user
to quickly understand what is going on.

The `capabilities` property must hold a string that defines what capability
(access to which perspectives and interface functions) should be requested.
This example requests all which might a good first step when starting to familiarize
yourself with AD4M, but should be restricted to what you really need for a production release.

If the user clicks authorize, `ad4m-connect` will connect to the AD4M-executor and request a capability token.
This will make the AD4M launcher bring up its pop-up window:

![ad4m-connect-pop-up](/images/authorize.jpg)

Here the user has to confirm the request to their AD4M instance.
Next, AD4M will then show a six-digit random secret code that needs to be entered into the app UI.
That way we have safely established that the network agent initiating the capability request (as seen from
the AD4M-executor) really is the UI the users wants to use.

If all steps were completed successfully, the `ad4m-connect` modal dialog closes and your app is shown.
Now you just need to get the `Ad4mClient` out of `ad4m-connect`.

Then somewhere in the initialization part of your app, do something like:

```typescript
import { Ad4mClient } from "@perspect3vism/ad4m";
import {
  getAd4mClient,
  onAuthStateChanged,
} from "@perspect3vism/ad4m-connect/web";

let ad4m: Ad4mClient = await new Promise((resolve, reject) => {
  onAuthStateChanged(async (status) => {
    if (status === "connected_with_capabilities") {
      alert("Connected  to Ad4m!");
      resolve(getAd4mClient());
    } else {
      alert("Not connected to Ad4m!");
    }
  });
});
```

Now you are ready to go and use the `ad4m` object to talk to the users AD4M-executor.

#### Node/Electron UI

`ad4m-connect` also works within an Electron app, but needs to be used a bit differently.
Instead of adding a web component to your UI, `ad4m-connect` will open its own Electron window
with that same UI component in it.
All you got to do is importing one function from `dist/electron`
(best done in your main Node/Electron start-up file)

```js
const { ad4mConnect } = require("@perspect3vism/ad4m-connect/dist/electron");
const path = require("path");

let ad4m: Ad4mClient = await new Promise((resolve, reject) => {
  ad4mConnect({
    appName: "Perspect3ve",
    appIconPath: path.join(__dirname, "graphics", "Logo.png"),
    capabilities: [{ with: { domain: "*", pointers: ["*"] }, can: ["*"] }],
    dataPath: path.join(homedir(), ".perspect3ve"),
  })
    .then(({ client, capabilityToken, executorUrl }) => {
      resolve(client);
    })
    .catch(() => reject());
});
```

There is one addition: `dataPath`.
The Node/Electron version of `ad4m-connect` stores the capability token (and executor URL)
to a file in the directory provided as `dataPath`.

</Steps>
